<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="preconnect" href="https://res.cloudinary.com">
    <title>Property Gallery</title>
    <style>
        .gallery {
            display: flex;
            flex-direction: column;
            gap: 20px;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .gallery-row {
            display: flex;
            gap: 20px;
            width: 100%;
        }

        .gallery-item {
            position: relative;
            overflow: hidden;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            cursor: pointer;
            aspect-ratio: 4/3;
            background: #f0f0f0;
        }

        .gallery-item img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            opacity: 0;
            transition: opacity 0.3s ease, transform 0.3s ease;
        }

        .gallery-item img.loaded {
            opacity: 1;
        }

        .gallery-item:hover img {
            transform: scale(1.05);
        }

        .flex-1 { flex: 1; }
        .flex-2 { flex: 2; }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.9);
            z-index: 1000;
        }

        .modal.active {
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .modal-content {
            position: relative;
            max-width: 90%;
            max-height: 90vh;
        }

        .modal-image {
            max-width: 100%;
            max-height: 90vh;
            object-fit: contain;
        }

        .close-button {
            position: absolute;
            top: -40px;
            right: 0;
            color: white;
            font-size: 30px;
            background: none;
            border: none;
            cursor: pointer;
        }

        .back-button {
            position: fixed;
            bottom: 30px;
            left: 30px;
            padding: 12px 24px;
            background-color: rgba(0, 0, 0, 0.8);
            color: white;
            border: none;
            border-radius: 30px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: all 0.3s ease;
            z-index: 100;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
        }

        .back-button:hover {
            background-color: rgba(0, 0, 0, 0.9);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
        }

        .back-button::before {
            content: "←";
            font-size: 20px;
        }

        @media (max-width: 768px) {
            .gallery-row {
                flex-direction: column;
            }
            .gallery-item {
                width: 100% !important;
            }
        }
    </style>
</head>
<body>
    <button class="back-button" onclick="window.history.back()">Back to Property</button>
    <div class="gallery" id="gallery"></div>

    <div class="modal" id="modal">
        <div class="modal-content">
            <button class="close-button">&times;</button>
            <img class="modal-image" src="" alt="Large view">
        </div>
    </div>

    <script>
        function getOptimizedImageUrl(originalUrl, width) {
            const matches = originalUrl.match(/v\d+\/(.+?)$/);
            if (!matches) return originalUrl;
            const publicId = matches[1];
            return `https://res.cloudinary.com/dlbgrsaal/image/upload/f_auto,q_auto,w_${width}/${publicId}`;
        }

        const images = [
'https://res.cloudinary.com/dlbgrsaal/image/upload/v1736907976/6463_Trammel_Dr_1_vdvnqs.jpg’,
'https://res.cloudinary.com/dlbgrsaal/image/upload/v1736907981/6463_Trammel_Dr_10_usc1cr.jpg’,
'https://res.cloudinary.com/dlbgrsaal/image/upload/v1736907981/6463_Trammel_Dr_11_ticwqa.jpg’,
'https://res.cloudinary.com/dlbgrsaal/image/upload/v1736907981/6463_Trammel_Dr_12_oznyvr.jpg’,
'https://res.cloudinary.com/dlbgrsaal/image/upload/v1736907982/6463_Trammel_Dr_13_a12ish.jpg’,
'https://res.cloudinary.com/dlbgrsaal/image/upload/v1736907982/6463_Trammel_Dr_14_mslsbf.jpg’,
'https://res.cloudinary.com/dlbgrsaal/image/upload/v1736907983/6463_Trammel_Dr_15_cxskq9.jpg’,
'https://res.cloudinary.com/dlbgrsaal/image/upload/v1736907984/6463_Trammel_Dr_16_s4uqdv.jpg’,
'https://res.cloudinary.com/dlbgrsaal/image/upload/v1736907984/6463_Trammel_Dr_17_xyivml.jpg’,
'https://res.cloudinary.com/dlbgrsaal/image/upload/v1736907985/6463_Trammel_Dr_18_k9qy7g.jpg’,
'https://res.cloudinary.com/dlbgrsaal/image/upload/v1736907986/6463_Trammel_Dr_19_wiklkk.jpg’,
'https://res.cloudinary.com/dlbgrsaal/image/upload/v1736907978/6463_Trammel_Dr_2_idvwr0.jpg’,
'https://res.cloudinary.com/dlbgrsaal/image/upload/v1736907987/6463_Trammel_Dr_20_z5ikyx.jpg’,
'https://res.cloudinary.com/dlbgrsaal/image/upload/v1736907987/6463_Trammel_Dr_21_qzd7jo.jpg’,
'https://res.cloudinary.com/dlbgrsaal/image/upload/v1736907988/6463_Trammel_Dr_22_tpgceb.jpg’,
'https://res.cloudinary.com/dlbgrsaal/image/upload/v1736907989/6463_Trammel_Dr_23_caux2c.jpg’,
'https://res.cloudinary.com/dlbgrsaal/image/upload/v1736907989/6463_Trammel_Dr_24_n23dl8.jpg’,
'https://res.cloudinary.com/dlbgrsaal/image/upload/v1736907990/6463_Trammel_Dr_25_rbedri.jpg’,
'https://res.cloudinary.com/dlbgrsaal/image/upload/v1736907990/6463_Trammel_Dr_26_blhf2t.jpg’,
'https://res.cloudinary.com/dlbgrsaal/image/upload/v1736907991/6463_Trammel_Dr_27_wteb3h.jpg’,
'https://res.cloudinary.com/dlbgrsaal/image/upload/v1736907991/6463_Trammel_Dr_28_knbxei.jpg’,
'https://res.cloudinary.com/dlbgrsaal/image/upload/v1736907992/6463_Trammel_Dr_29_rx3tms.jpg’,
'https://res.cloudinary.com/dlbgrsaal/image/upload/v1736907977/6463_Trammel_Dr_3_aujcpv.jpg’,
'https://res.cloudinary.com/dlbgrsaal/image/upload/v1736907993/6463_Trammel_Dr_30_hcji1o.jpg’,
'https://res.cloudinary.com/dlbgrsaal/image/upload/v1736907993/6463_Trammel_Dr_31_l2mgbx.jpg’,
'https://res.cloudinary.com/dlbgrsaal/image/upload/v1736907994/6463_Trammel_Dr_32_riqgmv.jpg’,
'https://res.cloudinary.com/dlbgrsaal/image/upload/v1736907994/6463_Trammel_Dr_33_kgb24k.jpg’,
'https://res.cloudinary.com/dlbgrsaal/image/upload/v1736907978/6463_Trammel_Dr_4_yxrhxd.jpg’,
'https://res.cloudinary.com/dlbgrsaal/image/upload/v1736907978/6463_Trammel_Dr_5_faltok.jpg’,
'https://res.cloudinary.com/dlbgrsaal/image/upload/v1736907978/6463_Trammel_Dr_6_zgyduy.jpg’,
'https://res.cloudinary.com/dlbgrsaal/image/upload/v1736907979/6463_Trammel_Dr_7_s8kyc9.jpg’,
'https://res.cloudinary.com/dlbgrsaal/image/upload/v1736907981/6463_Trammel_Dr_8_fuqz7s.jpg’,
'https://res.cloudinary.com/dlbgrsaal/image/upload/v1736907980/6463_Trammel_Dr_9_r6sc4x.jpg’,
        ];

        const patterns = [
            [1, 1, 1],  // Three equal columns
            [1, 2],     // Small, large
            [2, 1]      // Large, small
        ];

        function createBalancedRows(images) {
            const rows = [];
            let currentPattern;
            let remainingImages = [...images];
            
            while (remainingImages.length > 0) {
                const availablePatterns = patterns.filter(pattern => 
                    !currentPattern || 
                    !arraysEqual(pattern, currentPattern)
                );
                
                const patternIndex = Math.floor(Math.random() * availablePatterns.length);
                currentPattern = availablePatterns[patternIndex];
                
                const row = currentPattern.map(flex => {
                    const img = remainingImages.shift();
                    return img ? { src: img, flex } : null;
                }).filter(Boolean);
                
                if (row.length > 0) {
                    rows.push(row);
                }
            }
            
            return rows;
        }

        function arraysEqual(a, b) {
            return JSON.stringify(a) === JSON.stringify(b);
        }

        function createImageElement(src, flex) {
            const img = document.createElement('img');
            // Adjust image width based on flex value
            const width = flex === 1 ? 400 : 800;
            img.src = getOptimizedImageUrl(src, width);
            img.dataset.fullsize = getOptimizedImageUrl(src, 1200);
            img.alt = 'Property image';
            img.loading = 'lazy';
            
            img.onload = function() {
                this.classList.add('loaded');
            };
            
            return img;
        }

        const gallery = document.getElementById('gallery');
        const modal = document.getElementById('modal');
        const modalImg = modal.querySelector('.modal-image');
        const closeButton = modal.querySelector('.close-button');

        // Create gallery with balanced rows
        const rows = createBalancedRows(images);
        rows.forEach(row => {
            const rowDiv = document.createElement('div');
            rowDiv.className = 'gallery-row';
            
            row.forEach(image => {
                const div = document.createElement('div');
                div.className = `gallery-item flex-${image.flex}`;
                div.appendChild(createImageElement(image.src, image.flex));
                rowDiv.appendChild(div);
            });
            
            gallery.appendChild(rowDiv);
        });

        // Modal functionality
        gallery.addEventListener('click', (e) => {
            const img = e.target.closest('img');
            if (img) {
                modalImg.src = img.dataset.fullsize;
                modal.classList.add('active');
                document.body.style.overflow = 'hidden';
            }
        });

        closeButton.addEventListener('click', () => {
            modal.classList.remove('active');
            document.body.style.overflow = '';
        });

        modal.addEventListener('click', (e) => {
            if (e.target === modal) {
                modal.classList.remove('active');
                document.body.style.overflow = '';
            }
        });

        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape' && modal.classList.contains('active')) {
                modal.classList.remove('active');
                document.body.style.overflow = '';
            }
        });
    </script>
    <script src="js/gallery.js"></script>
</body>
</html>